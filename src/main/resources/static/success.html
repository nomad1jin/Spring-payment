<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>결제 성공</title>
</head>
<body>
<h1>결제 성공!</h1>
<p>승인 처리 중...</p>

<script>
    // URL 파라미터에서 값 추출
    const urlParams = new URLSearchParams(window.location.search);
    const paymentKey = urlParams.get("paymentKey");
    const orderId = urlParams.get("orderId");
    const amount = urlParams.get("amount");

    const accessToken = localStorage.getItem("accessToken");

    // 백엔드로 승인 요청 보내기
    fetch("http://localhost:8080/api/v1/payments/toss", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${accessToken}`
        },
        body: JSON.stringify({ paymentKey, orderId, amount })
    })
        .then(res => res.json())
        .then(data => {
            console.log("결제 승인 결과:", data);
            document.body.innerHTML = `<h2>결제 승인 완료 ✅</h2><pre>${JSON.stringify(data, null, 2)}</pre>`;
        })
        .catch(err => {
            console.error("결제 승인 실패:", err);
            document.body.innerHTML = `<h2>결제 승인 실패 ❌</h2>`;
        });
</script>
</body>
</html>